<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="hadoop,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="Sparkçš„æ ¸å¿ƒRDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)">
<meta name="keywords" content="hadoop">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸€èµ·å­¦Spark-2">
<meta property="og:url" content="http://yoursite.com/2018/01/23/ä¸€èµ·å­¦Spark-2/index.html">
<meta property="og:site_name" content="Dottieworks">
<meta property="og:description" content="Sparkçš„æ ¸å¿ƒRDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-11-13T04:53:42.588Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä¸€èµ·å­¦Spark-2">
<meta name="twitter:description" content="Sparkçš„æ ¸å¿ƒRDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/01/23/ä¸€èµ·å­¦Spark-2/">





  <title>ä¸€èµ·å­¦Spark-2 | Dottieworks</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dottieworks</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">çˆ±æŠ˜è…¾ ä¼šå†™ä¸€ç‚¹ä»£ç  æç®€ä¸»ä¹‰ = =</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/23/ä¸€èµ·å­¦Spark-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daejong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dottieworks">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ä¸€èµ·å­¦Spark-2</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-23T16:54:44+08:00">
                2018-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>Sparkçš„æ ¸å¿ƒRDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)</p>
</blockquote>
<a id="more"></a>
<h2 id="å…ˆçƒ­ä¸‹èº«ğŸ˜œ-Hadoop"><a href="#å…ˆçƒ­ä¸‹èº«ğŸ˜œ-Hadoop" class="headerlink" title="å…ˆçƒ­ä¸‹èº«ğŸ˜œ Hadoop"></a>å…ˆçƒ­ä¸‹èº«ğŸ˜œ Hadoop</h2><blockquote>
<p>Hadoopçš„æ ¸å¿ƒæŠ€æœ¯éƒ½æ˜¯ä¸ºäº†æŠŠä¼ ç»Ÿçš„å•ç‚¹å¼ç»“æ„è½¬å˜ä¸ºåˆ†å¸ƒå¼ç»“æ„:</p>
<ol>
<li>æŠŠå•æœºæ–‡ä»¶å­˜å‚¨è½¬å˜ä¸ºåˆ†å¸ƒå¼å­˜å‚¨â€”â€”HDFSï¼›</li>
<li>æŠŠå•æœºè®¡ç®—è½¬å˜ä¸ºåˆ†å¸ƒå¼è®¡ç®—â€”â€”MapReduceï¼›</li>
<li>æŠŠå•æœºæ•°æ®åº“è½¬æ¢ä¸ºåˆ†å¸ƒå¼æ•°æ®åº“â€”â€”Hbaseå’ŒHive</li>
</ol>
</blockquote>
<h2 id="ScalaåŸºç¡€"><a href="#ScalaåŸºç¡€" class="headerlink" title="ScalaåŸºç¡€"></a>ScalaåŸºç¡€</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Scalaå’ŒJavaå¾ˆåƒ. ç”¨è¿‡java8ä¸­lambdaè¡¨è¾¾å¼çš„(æˆ‘ä¹‹å‰åšå®¢ä¸­æœ‰å†™), ä¸Šæ‰‹ä¼šæ›´å¿«çš„.</span><br><span class="line"></span><br><span class="line">Scalaä¸­æ•°æ®ç±»å‹ç¬¬ä¸€ä¸ªå­—æ¯éƒ½æ˜¯å¤§å†™: <span class="built_in">Int</span>, <span class="built_in">Long</span>, <span class="built_in">Char</span>, Array, String, <span class="built_in">Float</span>, <span class="built_in">Double</span>, <span class="built_in">Boolean</span>, Null, Any.....</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. åˆ›å»ºå˜é‡ç”¨<span class="keyword">var</span>(åˆ†é…ä»¥åè¿˜å¯æŒ‡å‘ç±»å‹ç›¸åŒçš„å€¼)æˆ–è€…<span class="keyword">val</span>(å˜é‡å€¼ä¸€ç»åˆ†é…å°±ä¸å¯ä¿®æ”¹).</span><br><span class="line">å¦‚:</span><br><span class="line">scala&gt; <span class="keyword">var</span> num = <span class="number">1</span></span><br><span class="line">num: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; num = <span class="string">"hello"</span></span><br><span class="line">&lt;console&gt;:<span class="number">25</span>: error: type mismatch;</span><br><span class="line"> found   : String(<span class="string">"hello"</span>)</span><br><span class="line"> required: <span class="built_in">Int</span></span><br><span class="line">       num = <span class="string">"hello"</span></span><br><span class="line">             ^</span><br><span class="line"></span><br><span class="line">å†å¦‚:</span><br><span class="line">scala&gt; <span class="keyword">val</span> num = <span class="number">1</span></span><br><span class="line">num: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; num = <span class="number">2</span></span><br><span class="line">&lt;console&gt;:<span class="number">25</span>: error: reassignment to <span class="keyword">val</span></span><br><span class="line">       num = <span class="number">2</span></span><br><span class="line">           ^</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. åŒ¿åå‡½æ•°å’Œç±»å‹æ¨æ–­</span><br><span class="line">  lines.filter(line =&gt; line.contains(<span class="string">"world"</span>))</span><br><span class="line">  å³: filterå‡½æ•°é‡Œé¢çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°; ç®­å¤´å‰é¢æ˜¯params, åé¢æ˜¯body. é»˜è®¤ä¼šæ¨æ–­å‡ºå‚æ•°lineæ˜¯stringç±»å‹. ç„¶åè°ƒç”¨stringç±»çš„containsæ–¹æ³•.</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. å‡½æ•°:</span><br><span class="line">def add(x:<span class="built_in">Int</span>, y:<span class="built_in">Int</span>): <span class="built_in">Int</span> = &#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¸¦é»˜è®¤å‚æ•°çš„å‡½æ•°:</span><br><span class="line">def add(x:<span class="built_in">Int</span> = <span class="number">0</span>, y:<span class="built_in">Int</span> = <span class="number">0</span>):<span class="built_in">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¯ä»¥æŒ‡å®šæœ€åä¸€ä¸ªå‚æ•°ä¸ºå¯å˜å‚æ•°ï¼Œ ä»è€Œæ¥å—æ•°ç›®ä¸å®šçš„åŒç±»å‹å®å‚:</span><br><span class="line">scala&gt; def echo (args: String *) &#123; <span class="keyword">for</span> (arg &lt;- args) println(arg) &#125;</span><br><span class="line"></span><br><span class="line">scala&gt; echo(<span class="string">"Hello"</span>, <span class="string">"World"</span>)</span><br><span class="line">Hello</span><br><span class="line">World</span><br><span class="line"></span><br><span class="line">å‘½åå‚æ•°å…è®¸ä»¥ä»»æ„é¡ºåºä¼ å…¥å‚æ•°:</span><br><span class="line">scala&gt; def speed(dist:<span class="built_in">Double</span>, time:<span class="built_in">Double</span>):<span class="built_in">Double</span> = &#123;<span class="keyword">return</span> dist / time&#125;</span><br><span class="line"></span><br><span class="line">scala&gt; speed(time=<span class="number">2.0</span>, dist=<span class="number">12.2</span>)</span><br><span class="line">res28: <span class="built_in">Double</span> = <span class="number">6.1</span></span><br><span class="line"></span><br><span class="line">**æ³¨æ„**</span><br><span class="line">è¿˜æœ‰æ³¨æ„: scalaçš„å‚æ•°ä¼ é€’é‡‡ç”¨ä¼ å€¼çš„æ–¹å¼ï¼Œ å‚æ•°è¢«å½“åšå¸¸é‡<span class="keyword">val</span>è€Œéå˜é‡<span class="keyword">var</span>ä¼ å…¥.</span><br><span class="line">scala&gt; def swap(x:<span class="built_in">Int</span>, y:<span class="built_in">Int</span>) &#123;<span class="keyword">var</span> t = x; x = y; y = t;&#125;</span><br><span class="line">&lt;console&gt;: error: reassignment to <span class="keyword">val</span></span><br><span class="line">       def swap(x:<span class="built_in">Int</span>, y:<span class="built_in">Int</span>) &#123;<span class="keyword">var</span> t = x; x = y; y = t;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD-å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"><a href="#Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD-å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†" class="headerlink" title="Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)"></a>Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">ä¸€ä¸ªRDDSæ˜¯ä¸€ä¸ªä¸å¯æ”¹å˜çš„åˆ†å¸ƒå¼é›†åˆå¯¹è±¡.</span></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">Sparkä¸­,</span> <span class="string">æ‰€æœ‰çš„è®¡ç®—éƒ½æ˜¯é€šè¿‡RDDsçš„åˆ›å»º,</span> <span class="string">è½¬æ¢,</span> <span class="string">æ“ä½œå®Œæˆçš„.</span></span><br><span class="line"><span class="number">3</span><span class="string">.</span> <span class="string">ä¸€ä¸ªRDDå†…éƒ¨æ˜¯ç”±è®¸å¤šåˆ†ç‰‡(partitions)ç»„æˆ.</span></span><br><span class="line"><span class="number">4</span><span class="string">.</span> <span class="string">æ¯ä¸ªåˆ†ç‰‡åŒ…æ‹¬ä¸€éƒ¨åˆ†æ•°æ®,</span> <span class="string">partitionså¯åœ¨é›†ç¾¤ä¸åŒèŠ‚ç‚¹ä¸Šè®¡ç®—.</span></span><br><span class="line"><span class="number">5</span><span class="string">.</span> <span class="string">åˆ†ç‰‡æ˜¯Sparkå¹¶è¡Œå¤„ç†å•å…ƒ,</span> <span class="string">Sparkä¸­é¡ºåº,</span> <span class="string">å¹¶è¡Œçš„å¤„ç†åˆ†ç‰‡.</span></span><br><span class="line"><span class="number">6</span><span class="string">.</span> <span class="string">SparkContextå¯¹è±¡ä»£è¡¨å’Œä¸€ä¸ªé›†ç¾¤çš„è¿æ¥.</span> <span class="string">åœ¨spark</span> <span class="string">shellä¸­è¯¥å¯¹è±¡å·²ç»å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†,</span> <span class="string">ä¹‹é—´å¼•ç”¨å³å¯(scå°±æ˜¯SparkContextå¯¹è±¡)</span></span><br><span class="line"><span class="string">å¦‚:</span></span><br><span class="line"><span class="string">scala&gt;</span> <span class="string">var</span> <span class="string">lines</span> <span class="string">=</span> <span class="string">sc.textFile("../../hello.txt")</span></span><br><span class="line"><span class="attr">lines:</span> <span class="string">org.apache.spark.rdd.RDD[String]</span> <span class="string">=</span> <span class="string">../../hello.txt</span> <span class="string">MapPartitionsRDD[1]</span> <span class="string">at</span> <span class="string">textFile</span> <span class="string">at</span> <span class="string">&lt;console&gt;:24</span></span><br><span class="line"></span><br><span class="line"><span class="string">è¿™é‡Œçš„lineså°±æ˜¯ä¸€ä¸ªRDD.</span></span><br><span class="line"></span><br><span class="line"><span class="string">RDDçš„åˆ›å»ºæ–¹æ³•:</span></span><br><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">æŠŠä¸€ä¸ªå­˜åœ¨çš„é›†åˆä½œä¸ºå‚æ•°ä¼ ç»™SparkContext(sc)çš„parallelize()æ–¹æ³•,</span> <span class="string">ä¸€èˆ¬åœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨:</span></span><br><span class="line">  <span class="string">val</span> <span class="string">rdd</span> <span class="string">=</span> <span class="string">sc.parallelize(Array(1,</span> <span class="number">3</span><span class="string">,</span> <span class="number">2</span><span class="string">,</span> <span class="number">4</span><span class="string">),</span> <span class="number">4</span><span class="string">)</span></span><br><span class="line">  <span class="string">å‚æ•°ä¸€:</span> <span class="string">å¾…å¹¶è¡Œå¤„ç†çš„é›†åˆ,</span></span><br><span class="line">  <span class="string">å‚æ•°äºŒ:</span> <span class="string">åˆ†åŒºçš„ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">val</span> <span class="string">rdd</span> <span class="string">=</span> <span class="string">sc.parallelize(Array(1,</span> <span class="number">3</span><span class="string">,</span> <span class="number">2</span><span class="string">,</span> <span class="number">4</span><span class="string">),</span> <span class="number">2</span><span class="string">)</span></span><br><span class="line">  <span class="attr">rdd:</span> <span class="string">org.apache.spark.rdd.RDD[Int]</span> <span class="string">=</span> <span class="string">ParallelCollectionRDD[1]</span> <span class="string">at</span> <span class="string">parallelize</span> <span class="string">at</span> <span class="string">&lt;console&gt;:24</span></span><br><span class="line"></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.count</span></span><br><span class="line">  <span class="attr">res1:</span> <span class="string">Long</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.foreach(println)</span></span><br><span class="line">  <span class="number">2134</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">åŠ è½½å¤–éƒ¨æ•°æ®é›†</span></span><br><span class="line">   <span class="string">val</span> <span class="string">rdd</span> <span class="string">=</span> <span class="string">sc.textFile("hello.txt")</span></span><br></pre></td></tr></table></figure>
<h2 id="RDDçš„åŸºæœ¬æ“ä½œ"><a href="#RDDçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="RDDçš„åŸºæœ¬æ“ä½œ"></a>RDDçš„åŸºæœ¬æ“ä½œ</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">Transformations(è½¬æ¢):</span><br><span class="line">ä»ä¹‹å‰çš„RDDæ„å»ºä¸€ä¸ªæ–°çš„RDD, æƒ³map(), filter()</span><br><span class="line">æ„Ÿè§‰è¿™é‡Œå¾ˆåƒjava8ä¸­lambdaè¡¨è¾¾å¼ä¸­çš„filter(ä»ä¸€ä¸ª<span class="keyword">list</span>ä¸­, æ ¹æ®æ¡ä»¶è¿‡æ»¤å‡º<span class="keyword">list</span>ä¸­éœ€è¦çš„item, ç„¶ååœ¨ç»„æˆä¸€ä¸ª<span class="keyword">list</span>).</span><br><span class="line"></span><br><span class="line">1. map()æ¥å—å‡½æ•°, æŠŠå‡½æ•°åº”ç”¨åˆ°RDDçš„æ¯ä¸ªå…ƒç´ , è¿”å›ä¸€ä¸ªæ–°çš„RDD</span><br><span class="line">ç¤ºä¾‹æ•°æ®:</span><br><span class="line"><span class="keyword">scala</span>&gt; val rdd = <span class="keyword">sc</span>.parallelize(Array(<span class="string">"hello"</span>, <span class="string">"dottie"</span>, <span class="string">"hello"</span>, <span class="string">"daejong"</span>, <span class="string">"hello"</span>, <span class="string">"China"</span>))</span><br><span class="line">rdd: org.apache.spark.rdd.RDD[String] = ParallelCollectionRDD[6] at parallelize at &lt;console&gt;:24</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; rdd.<span class="keyword">foreach</span>(println)</span><br><span class="line">hello</span><br><span class="line">daejong</span><br><span class="line">hello</span><br><span class="line">China</span><br><span class="line">dottie</span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line">äº§ç”Ÿä¸€ä¸ªæ–°çš„rdd1</span><br><span class="line"><span class="keyword">scala</span>&gt; val rdd1 = rdd.map(word=&gt;(word,1))</span><br><span class="line">rdd1: org.apache.spark.rdd.RDD[(String, Int)] = MapPartitionsRDD[7] at map at &lt;console&gt;:26</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; rdd1.<span class="keyword">foreach</span>(println)</span><br><span class="line">(hello,1)</span><br><span class="line">(dottie,1)</span><br><span class="line">(hello,1)</span><br><span class="line">(daejong,1)</span><br><span class="line">(hello,1)</span><br><span class="line">(China,1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. filter()å‡½æ•°: è¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span><br><span class="line"><span class="keyword">scala</span>&gt;  val rdd2 = rdd.filter(word=&gt;word.contains(<span class="string">"hello"</span>))</span><br><span class="line">rdd2: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[8] at filter at &lt;console&gt;:26</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; rdd2.<span class="keyword">foreach</span>(println)</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. flatMap():</span><br><span class="line">å¯¹æ¯ä¸ªè¾“å…¥å…ƒç´ , è¾“å‡ºå¤šä¸ªå…ƒç´ </span><br><span class="line">flatæ˜¯å‹æ‰çš„æ„æ€, å°†rddä¸­å…ƒç´ å‹æ‰åè¿”å›ä¸€ä¸ªæ–°çš„rdd.</span><br><span class="line">ç¤ºä¾‹æ•°æ®:</span><br><span class="line"><span class="keyword">scala</span>&gt; val <span class="keyword">input</span> = <span class="keyword">sc</span>.textFile(<span class="string">"hello.txt"</span>)</span><br><span class="line"><span class="keyword">input</span>: org.apache.spark.rdd.RDD[String] = hello.txt MapPartitionsRDD[10] at textFile at &lt;console&gt;:24</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; <span class="keyword">input</span>.<span class="keyword">foreach</span>(println)</span><br><span class="line">i love RDD</span><br><span class="line">hello daejong</span><br><span class="line">hello dottie</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; val lines = <span class="keyword">input</span>.flatMap(<span class="keyword">line</span>=&gt;<span class="keyword">line</span>.<span class="keyword">split</span>(<span class="string">" "</span>))</span><br><span class="line">lines: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[11] at flatMap at &lt;console&gt;:26</span><br><span class="line"></span><br><span class="line">è¿™é‡Œä¼šå¯¹å°†æ¯ä¸€è¡ŒæŒ‰ç…§ç©ºæ ¼åˆ†éš”æˆå¤šä¸ªå…ƒç´ , æœ€åå¯¹æ‰€æœ‰ç»“æœflat(å‹æ‰)æˆä¸€è¡Œå¤šä¸ªå…ƒç´ .</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; lines.<span class="keyword">foreach</span>(println)</span><br><span class="line">hello</span><br><span class="line">daejong</span><br><span class="line">hello</span><br><span class="line">dottie</span><br><span class="line">i</span><br><span class="line">love</span><br><span class="line">RDD</span><br><span class="line"></span><br><span class="line">å¦‚æœæˆ‘ä»¬ä¸é€‚ç”¨printlnå‡½æ•°:</span><br><span class="line"><span class="keyword">scala</span>&gt; lines.<span class="keyword">foreach</span>(<span class="keyword">print</span>)</span><br><span class="line">helloidaejongloveRDDhellodottie</span><br><span class="line">åˆ™ä¼šå°†æ‰€æœ‰å•è¯è¾“å‡ºåˆ°ä¸€èµ·.</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹linesçš„è¾“å‡º:</span><br><span class="line"><span class="keyword">scala</span>&gt; lines</span><br><span class="line">res23: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[11] at flatMap at &lt;console&gt;:26</span><br><span class="line"></span><br><span class="line">ç„¶åæˆ‘ä»¬å†å¯¹linesä½¿ç”¨mapå‡½æ•°äº§ç”Ÿä¸€ä¸ªæ–°çš„rdd.</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt;  val maprdd = lines.map(word=&gt;(word, 1))</span><br><span class="line">maprdd: org.apache.spark.rdd.RDD[(String, Int)] = MapPartitionsRDD[12] at map at &lt;console&gt;:28</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; maprdd.<span class="keyword">foreach</span>(println)</span><br><span class="line">[Stage 15:&gt;                                                         (0 + 0) / 2](i,1)</span><br><span class="line">(love,1)</span><br><span class="line">(RDD,1)</span><br><span class="line">(hello,1)</span><br><span class="line">(daejong,1)</span><br><span class="line">(hello,1)</span><br><span class="line">(dottie,1)</span><br><span class="line"></span><br><span class="line">æœ€åæˆ‘ä»¬å¯ä»¥å®ç°æˆ‘ä»¬ä¹‹å‰å­¦hadoopæ—¶çš„mapreduceä¸­wordcountç¨‹åº</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; val maprdddd = maprdd.reduceByKey((x, y) =&gt; x + y)</span><br><span class="line">maprdddd: org.apache.spark.rdd.RDD[(String, Int)] = ShuffledRDD[14] at reduceByKey at &lt;console&gt;:30</span><br><span class="line"></span><br><span class="line"><span class="keyword">scala</span>&gt; maprdddd.<span class="keyword">foreach</span>(println)</span><br><span class="line">(love,1)</span><br><span class="line">(i,1)</span><br><span class="line">(dottie,1)</span><br><span class="line">(daejong,1)</span><br><span class="line">(hello,2)</span><br><span class="line">(RDD,1)</span><br><span class="line"></span><br><span class="line">è¿™é‡Œçš„ç®—å­reduceByKey, æ˜¯æ ¹æ®ä¸€ä¸ªmapä¸­çš„keyè¿›è¡Œåˆ¤æ–­, å¦‚æœkeyç›¸åŒ,åˆ™å°†å¯¹åº”çš„valueç›¸åŠ . è¿™é‡Œçš„å‚æ•°å°±æ˜¯ value å€¼.</span><br></pre></td></tr></table></figure>
<h2 id="RDDsä¸­çš„é›†åˆè¿ç®—"><a href="#RDDsä¸­çš„é›†åˆè¿ç®—" class="headerlink" title="RDDsä¸­çš„é›†åˆè¿ç®—"></a>RDDsä¸­çš„é›†åˆè¿ç®—</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹æ•°æ®:</span><br><span class="line"><span class="keyword">scala&gt; </span>val rdd1 = <span class="keyword">sc.parallelize(Array("apple", </span><span class="string">"orange"</span>, <span class="string">"banana"</span>, <span class="string">"pear"</span>, <span class="string">"milk"</span>))</span><br><span class="line"><span class="symbol">rdd1:</span> <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= ParallelCollectionRDD[<span class="number">15</span>] <span class="built_in">at</span> parallelize <span class="built_in">at</span> &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">scala&gt; </span>rdd1.foreach(println)</span><br><span class="line"><span class="keyword">banana</span></span><br><span class="line"><span class="keyword">pear</span></span><br><span class="line"><span class="keyword">milk</span></span><br><span class="line"><span class="keyword">orange</span></span><br><span class="line"><span class="keyword">apple</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">scala&gt; </span>val rdd2 = <span class="keyword">sc.parallelize(Array("apple", </span><span class="string">"black"</span>, <span class="string">"white"</span>, <span class="string">"banana"</span>, <span class="string">"yellow"</span>, <span class="string">"red"</span>, <span class="string">"apple"</span>, <span class="string">"white"</span>))</span><br><span class="line"><span class="symbol">rdd2:</span> <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= ParallelCollectionRDD[<span class="number">17</span>] <span class="built_in">at</span> parallelize <span class="built_in">at</span> &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">scala&gt; </span>rdd2.foreach(println)</span><br><span class="line">yellow</span><br><span class="line">white</span><br><span class="line"><span class="keyword">banana</span></span><br><span class="line"><span class="keyword">apple</span></span><br><span class="line"><span class="keyword">black</span></span><br><span class="line"><span class="keyword">apple</span></span><br><span class="line"><span class="keyword">white</span></span><br><span class="line"><span class="keyword">red</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">1. </span>æˆ‘ä»¬å¯ä»¥å¯¹rdd2å…ƒç´ è¿›è¡Œå»é‡.</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd_distinct = rdd2.<span class="keyword">distinct</span></span><br><span class="line"><span class="keyword"> </span> rdd_distinct: <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= MapPartitionsRDD[<span class="number">20</span>] <span class="built_in">at</span> <span class="keyword">distinct </span><span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd_distinct.foreach(println)</span><br><span class="line">  yellow</span><br><span class="line">  white</span><br><span class="line">  <span class="keyword">banana</span></span><br><span class="line"><span class="keyword"> </span> red</span><br><span class="line">  <span class="keyword">black</span></span><br><span class="line"><span class="keyword"> </span> apple</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. è·å–rdd1å’Œrdd2çš„å¹¶é›†</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd_union = rdd1.union(rdd2)</span><br><span class="line"><span class="symbol">  rdd_union:</span> <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= UnionRDD[<span class="number">21</span>] <span class="built_in">at</span> union <span class="built_in">at</span> &lt;console&gt;:<span class="number">28</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd_union.foreach(println)</span><br><span class="line">  apple</span><br><span class="line">  <span class="keyword">banana</span></span><br><span class="line"><span class="keyword"> </span> <span class="keyword">orange</span></span><br><span class="line"><span class="keyword"> </span> pear</span><br><span class="line">  milk</span><br><span class="line">  apple</span><br><span class="line">  <span class="keyword">black</span></span><br><span class="line"><span class="keyword"> </span> white</span><br><span class="line">  <span class="keyword">banana</span></span><br><span class="line"><span class="keyword"> </span> yellow</span><br><span class="line">  red</span><br><span class="line">  apple</span><br><span class="line">  white</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. è·å–rdd1å’Œrdd2çš„äº¤é›†</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd_intersection = rdd1.intersection(rdd2)</span><br><span class="line"><span class="symbol">  rdd_intersection:</span> <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= MapPartitionsRDD[<span class="number">27</span>] <span class="built_in">at</span> intersection <span class="built_in">at</span> &lt;console&gt;:<span class="number">28</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd_intersection.foreach(println)</span><br><span class="line">  apple</span><br><span class="line">  <span class="keyword">banana</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">4. </span>è·å–rdd1ä¸rdd2çš„å·®é›†</span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd_subtract = rdd1.<span class="keyword">subtract(rdd2)</span></span><br><span class="line"><span class="keyword"> </span> rdd_subtract: <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= MapPartitionsRDD[<span class="number">31</span>] <span class="built_in">at</span> <span class="keyword">subtract </span><span class="built_in">at</span> &lt;console&gt;:<span class="number">28</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd_subtract.foreach(println)</span><br><span class="line">  <span class="keyword">orange</span></span><br><span class="line"><span class="keyword"> </span> pear</span><br><span class="line">  milk</span><br></pre></td></tr></table></figure>
<h2 id="RDDçš„Actionæ“ä½œ"><a href="#RDDçš„Actionæ“ä½œ" class="headerlink" title="RDDçš„Actionæ“ä½œ."></a>RDDçš„Actionæ“ä½œ.</h2><blockquote>
<p>ä¸Šé¢æˆ‘ä»¬å¯¹RDDçš„æ“ä½œéƒ½æ˜¯ä¸€ä¸ªè½¬æ¢çš„æ“ä½œ.</p>
<p>Action:  è¿™é‡Œæˆ‘ä»¬è¦åœ¨RDDè®¡ç®—å‡ºä¸€ä¸ªç»“æœ</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">reduce()</span></span><br><span class="line"><span class="string">æ¥æ”¶ä¸€ä¸ªå‡½æ•°,</span> <span class="string">ä½œç”¨åœ¨RDDä¸¤ä¸ªç±»å‹ç›¸åŒçš„å…ƒç´ ä¸Š,</span> <span class="string">è¿”å›æ–°å…ƒç´ .</span> <span class="string">å¯ä»¥å®ç°ç´¯åŠ ,è®¡æ•°ç­‰æ“ä½œ.</span></span><br><span class="line"></span><br><span class="line"><span class="string">scala&gt;</span> <span class="string">val</span> <span class="string">rdd</span> <span class="string">=</span> <span class="string">sc.parallelize(Array(1,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">,</span> <span class="number">4</span><span class="string">,</span> <span class="number">4</span><span class="string">))</span></span><br><span class="line"><span class="attr">rdd:</span> <span class="string">org.apache.spark.rdd.RDD[Int]</span> <span class="string">=</span> <span class="string">ParallelCollectionRDD[32]</span> <span class="string">at</span> <span class="string">parallelize</span> <span class="string">at</span> <span class="string">&lt;console&gt;:24</span></span><br><span class="line"></span><br><span class="line"><span class="string">scala&gt;</span> <span class="string">rdd.collect()</span></span><br><span class="line"><span class="attr">res36:</span> <span class="string">Array[Int]</span> <span class="string">=</span> <span class="string">Array(1,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">,</span> <span class="number">4</span><span class="string">,</span> <span class="number">4</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">scala&gt;</span> <span class="string">rdd.reduce((x,</span> <span class="string">y)</span> <span class="string">=&gt;</span> <span class="string">x</span> <span class="string">+</span> <span class="string">y)</span></span><br><span class="line"><span class="attr">res37:</span> <span class="string">Int</span> <span class="string">=</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">collect()</span> <span class="string">éå†æ•´ä¸ªrddå¹¶è¿”å›,</span> <span class="string">ä¸€èˆ¬ç”¨äºæµ‹è¯•</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.</span> <span class="string">take(n)</span> <span class="string">éšæœºåœ¨rddä¸­å–nä¸ªå…ƒç´ ,</span> <span class="string">ç»“æœæ— åºçš„.</span></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.take(4)</span></span><br><span class="line">  <span class="attr">res41:</span> <span class="string">Array[Int]</span> <span class="string">=</span> <span class="string">Array(1,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">,</span> <span class="number">4</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">.</span> <span class="string">top(n)</span> <span class="string">æ’åºè¾“å‡º</span></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.top(1)</span></span><br><span class="line">  <span class="attr">res43:</span> <span class="string">Array[Int]</span> <span class="string">=</span> <span class="string">Array(4)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.top(2)</span></span><br><span class="line">  <span class="attr">res44:</span> <span class="string">Array[Int]</span> <span class="string">=</span> <span class="string">Array(4,</span> <span class="number">4</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.top(3)</span></span><br><span class="line">  <span class="attr">res45:</span> <span class="string">Array[Int]</span> <span class="string">=</span> <span class="string">Array(4,</span> <span class="number">4</span><span class="string">,</span> <span class="number">3</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">.</span> <span class="string">foreach()</span> <span class="string">éå†è¾“å‡º,</span> <span class="string">æ³¨æ„:è¯¥å‡½æ•°ä¸ä¼šæœ‰è¿”å›å€¼.</span> <span class="string">å³ä¸ä¼šä¿å­˜åˆ°æœ¬åœ°.</span></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.foreach(e</span> <span class="string">=&gt;</span> <span class="string">println(e))</span></span><br><span class="line">  <span class="number">1</span></span><br><span class="line">  <span class="number">4</span></span><br><span class="line">  <span class="number">4</span></span><br><span class="line">  <span class="number">3</span></span><br><span class="line">  <span class="number">2</span></span><br><span class="line">  <span class="string">ç®€å†™:</span></span><br><span class="line">  <span class="string">scala&gt;</span> <span class="string">rdd.foreach(println)</span></span><br><span class="line">  <span class="number">4</span></span><br><span class="line">  <span class="number">4</span></span><br><span class="line">  <span class="number">2</span></span><br><span class="line">  <span class="number">1</span></span><br><span class="line">  <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h2 id="RDDsçš„ç‰¹æ€§"><a href="#RDDsçš„ç‰¹æ€§" class="headerlink" title="RDDsçš„ç‰¹æ€§"></a>RDDsçš„ç‰¹æ€§</h2><blockquote>
<p>Sparkç»´æŠ¤ç€RDDsä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œåˆ›å»ºå…³ç³», ç§°ä¹‹ä¸ºè¡€ç»Ÿå…³ç³»å›¾.</p>
<p>Sparkä½¿ç”¨è¡€ç»Ÿå…³ç³»å›¾æ¥è®¡ç®—æ¯ä¸ªRDDçš„éœ€æ±‚å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®.</p>
</blockquote>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å¦‚: rddç»è¿‡filteräº§ç”Ÿäº†rdd1, rdd1ç»è¿‡mapäº§ç”Ÿrdd2, rdd1å’Œrdd2ç»è¿‡<span class="class"><span class="keyword">union</span>æ“ä½œäº§ç”Ÿäº†<span class="title">rdd3</span>.</span></span><br><span class="line"></span><br><span class="line">ä»»ä½•ä¸€ä¸ªrddä¸¢å¤±éƒ½æ²¡å…³ç³», éƒ½å¯ä»¥é€šè¿‡è¡€ç»Ÿå…³ç³»å›¾ æ¢å¤ä¸¢å¤±çš„rdd.</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. å»¶è¿Ÿæ“ä½œ</span><br><span class="line">  ç¬¬ä¸€æ¬¡ä½¿ç”¨actionæ“ä½œ, sparkå¯¹rddçš„è®¡ç®—éƒ½ä¼šå»¶è¿Ÿ.</span><br><span class="line">  å¦‚åŠ è½½æ•°æ®ä¹Ÿæ˜¯ä¸€ä¸ªå»¶è¿Ÿè®¡ç®—, å› ä¸ºåªæœ‰æ•°æ®åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šè¢«åŠ è½½è¿›å».</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. æŒä¹…åŒ– persist()</span><br><span class="line">   é»˜è®¤æ¯æ¬¡åœ¨rddsä¸Šè¿›è¡Œactionæ“ä½œæ—¶, sparkéƒ½ä¼šé‡æ–°è®¡ç®—rdds.</span><br><span class="line">   è¦æƒ³é‡å¤åˆ©ç”¨ä¸€ä¸ªrdd, å¯ä»¥ä½¿ç”¨rdd.persist(), å¯ä»¥ä¼ å‚(ç¼“å­˜çš„çº§åˆ« )</span><br><span class="line">   unpersist()æ–¹æ³•ä»ç¼“å­˜ä¸­ç§»é™¤rdd.</span><br></pre></td></tr></table></figure>
<h2 id="RDDsçš„KeyValueå¯¹"><a href="#RDDsçš„KeyValueå¯¹" class="headerlink" title="RDDsçš„KeyValueå¯¹"></a>RDDsçš„KeyValueå¯¹</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. åˆ›å»ºkeyvalue</span><br><span class="line">   ä½¿ç”¨mapå‡½æ•°, è¿”å›keyValue</span><br><span class="line">   å¦‚: å°†æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯ä½œä¸ºkey, æ¯è¡Œçš„å€¼ä½œä¸ºvalue</span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd = <span class="keyword">sc.textFile("hello.txt")</span></span><br><span class="line"><span class="keyword"> </span> rdd: <span class="keyword">org.apache.spark.rdd.RDD[String] </span>= hello.txt MapPartitionsRDD[<span class="number">37</span>] <span class="built_in">at</span> textFile <span class="built_in">at</span> &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd.foreach(println)</span><br><span class="line">  i love RDD</span><br><span class="line">  hello daejong</span><br><span class="line">  hello dottie</span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd1 = rdd.map(line =&gt; (line.split(<span class="string">" "</span>)(<span class="number">0</span>), line))</span><br><span class="line"><span class="symbol">  rdd1:</span> <span class="keyword">org.apache.spark.rdd.RDD[(String, </span>String)] = MapPartitionsRDD[<span class="number">38</span>] <span class="built_in">at</span> map <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd1.foreach(println)</span><br><span class="line">  (hello,hello daejong)</span><br><span class="line">  (i,i love RDD)</span><br><span class="line">  (hello,hello dottie)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. æ‰‹åŠ¨æ„å»ºä¸€ä¸ªkeyvalueå¯¹, æµ‹è¯•</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd2 = <span class="keyword">sc.parallelize(Array((1, </span><span class="number">2</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">6</span>)))</span><br><span class="line"><span class="symbol">  rdd2:</span> <span class="keyword">org.apache.spark.rdd.RDD[(Int, </span>Int)] = ParallelCollectionRDD[<span class="number">40</span>] <span class="built_in">at</span> parallelize <span class="built_in">at</span> &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd2.foreach(println)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">  (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. è¿˜æœ‰sparkæä¾›çš„</span><br><span class="line">   reduceByKey(ä¹‹å‰åœ¨å†™wordcountç¨‹åºç”¨åˆ°çš„)</span><br><span class="line">   rdd.reduceByKey((value1, value2) =&gt; value1 + value2)</span><br><span class="line">   å°†ç›¸åŒkeyçš„valueå€¼ç›¸åŠ .</span><br><span class="line">   <span class="keyword">scala&gt; </span>val rdd3 = rdd2.reduceByKey((x, y) =&gt; x + y)</span><br><span class="line"><span class="symbol">   rdd3:</span> <span class="keyword">org.apache.spark.rdd.RDD[(Int, </span>Int)] = <span class="keyword">ShuffledRDD[42] </span><span class="built_in">at</span> reduceByKey <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">scala&gt; </span>rdd3.foreach(println)</span><br><span class="line">   (<span class="number">3</span>,<span class="number">10</span>)</span><br><span class="line">   (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   groupByKey() æŒ‰ç›¸åŒçš„keyè¿›è¡Œåˆ†ç»„</span><br><span class="line">  <span class="keyword">scala&gt; </span> val rdd4 = rdd2.groupByKey()</span><br><span class="line"><span class="symbol">  rdd4:</span> <span class="keyword">org.apache.spark.rdd.RDD[(Int, </span>Iterable[Int])] = <span class="keyword">ShuffledRDD[43] </span><span class="built_in">at</span> groupByKey <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd4.foreach(println)</span><br><span class="line">  (<span class="number">1</span>,CompactBuffer(<span class="number">2</span>))</span><br><span class="line">  (<span class="number">3</span>,CompactBuffer(<span class="number">4</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   mapValues() å¯¹æ¯ä¸ªkeyvalueå¯¹çš„valueè¿›è¡Œæ“ä½œ, keyä¸æ“ä½œ</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd5 = rdd2.mapValues(x =&gt; x+<span class="number">1</span>)</span><br><span class="line"><span class="symbol">  rdd5:</span> <span class="keyword">org.apache.spark.rdd.RDD[(Int, </span>Int)] = MapPartitionsRDD[<span class="number">44</span>] <span class="built_in">at</span> mapValues <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">   keys() è¿”å›keyçš„é›†åˆ</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd6 = rdd2.keys</span><br><span class="line"><span class="symbol">  rdd6:</span> <span class="keyword">org.apache.spark.rdd.RDD[Int] </span>= MapPartitionsRDD[<span class="number">45</span>] <span class="built_in">at</span> keys <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd6.foreach(println)</span><br><span class="line">  <span class="number">1</span></span><br><span class="line">  <span class="number">3</span></span><br><span class="line">  <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   values() è¿”å›valueçš„é›†åˆ</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd7 = rdd2.values</span><br><span class="line"><span class="symbol">  rdd7:</span> <span class="keyword">org.apache.spark.rdd.RDD[Int] </span>= MapPartitionsRDD[<span class="number">46</span>] <span class="built_in">at</span> values <span class="built_in">at</span> &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd7.foreach(println)</span><br><span class="line">  <span class="number">6</span></span><br><span class="line">  <span class="number">2</span></span><br><span class="line">  <span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd5.foreach(println)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">7</span>)</span><br><span class="line">  (<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">   sortByKey() æŒ‰ç…§keyæ¥æ’åº</span><br><span class="line">  <span class="keyword">scala&gt; </span>val rdd8 = rdd2.sortByKey().collect()</span><br><span class="line"><span class="symbol">  rdd8:</span> Array[(Int, Int)] = Array((<span class="number">1</span>,<span class="number">2</span>), (<span class="number">3</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">scala&gt; </span>rdd8.foreach(println)</span><br><span class="line">  (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">  (<span class="number">3</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">combineByKey();</span><br><span class="line">(create combiner, mergeValue, merge Combiner, partitioner)</span><br><span class="line">æœ€å¸¸ç”¨çš„åŸºäºkeyçš„èšåˆå‡½æ•°, è¿”å›çš„ç±»å‹å¯ä»¥ä¸è¾“å…¥çš„ç±»å‹ä¸ä¸€è‡´.</span><br><span class="line">è®¸å¤šåŸºäºkeyçš„èšåˆå‡½æ•°éƒ½ç”¨åˆ°äº†è¯¥å‡½æ•°. å¦‚groupByKey</span><br><span class="line">è¯¥å‡½æ•°ä¼šéå†partitionåˆ†åŒºä¸­çš„å…ƒç´ , å…ƒç´ çš„keyè¦ä¹ˆæ˜¯è§è¿‡, è¦ä¹ˆæ²¡è§è¿‡.</span><br><span class="line">å¦‚æœæ˜¯æ–°å…ƒç´ å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¼ å…¥çš„createCombinerå‡½æ•°</span><br><span class="line">å¦‚æœä¸æ˜¯æ–°å…ƒç´ (åˆ™partitionä¸­å·²ç»å­˜åœ¨key), å°±ä¼šä½¿ç”¨mergeValueå‡½æ•°</span><br><span class="line">åˆè®¡æ¯ä¸ªpartitionçš„ç»“æœæ—¶, ä½¿ç”¨mergeCombinerå‡½æ•°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: (æ±‚å¹³å‡å€¼)</span><br><span class="line">scala&gt; val rdd = sc.parallelize(<span class="built_in">Array</span>((<span class="string">"dottie"</span>, <span class="number">91.0</span>), (<span class="string">"dottie"</span>, <span class="number">78.0</span>), (<span class="string">"dottie"</span>, <span class="number">88.0</span>), (<span class="string">"daejong"</span>, <span class="number">89.0</span>), (<span class="string">"daejong"</span>, <span class="number">99.0</span>), (<span class="string">"daejong"</span>, <span class="number">97.0</span>)))</span><br><span class="line">rdd: org.apache.spark.rdd.RDD[(<span class="built_in">String</span>, Double)] = ParallelCollectionRDD[<span class="number">54</span>] at parallelize at &lt;<span class="built_in">console</span>&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; rdd.foreach(println)</span><br><span class="line">(dottie,<span class="number">91.0</span>)</span><br><span class="line">(dottie,<span class="number">78.0</span>)</span><br><span class="line">(dottie,<span class="number">88.0</span>)</span><br><span class="line">(daejong,<span class="number">89.0</span>)</span><br><span class="line">(daejong,<span class="number">99.0</span>)</span><br><span class="line">(daejong,<span class="number">97.0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¿˜æœ‰å¦‚ä½•è·å–keyå’Œvalueçš„å€¼</span><br><span class="line">scala&gt; val r1 = (<span class="number">1</span>, <span class="number">1111</span>)</span><br><span class="line">r1: (Int, Int) = (<span class="number">1</span>,<span class="number">1111</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; r1._1</span><br><span class="line">res77: Int = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; r1._2</span><br><span class="line">res78: Int = <span class="number">1111</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…ˆè®¡ç®—æ€»å’Œ</span><br><span class="line">scala&gt; val score = rdd.combineByKey(<span class="function"><span class="params">score</span>=&gt;</span><span class="function">(<span class="params">1, score</span>), (<span class="params">(<span class="params">c1:(<span class="params">Int, Double</span>), newScore</span>) =&gt; (<span class="params">c1._1+1, c1._2+newScore</span>)</span>), (<span class="params">(<span class="params">c1:(<span class="params">Int, Double</span>), c2:(<span class="params">Int, Double</span>)</span>) =&gt; (<span class="params">c1._1+c2._1, c1._2+c2._2</span>)</span>))</span></span><br><span class="line"><span class="function"><span class="params">score</span>: <span class="params">org</span>.<span class="params">apache</span>.<span class="params">spark</span>.<span class="params">rdd</span>.<span class="params">RDD</span>[(<span class="params"><span class="built_in">String</span>, (<span class="params">Int, Double</span>)</span>)] = <span class="params">ShuffledRDD</span>[55] <span class="params">at</span> <span class="params">combineByKey</span> <span class="params">at</span> &lt;<span class="params">console</span>&gt;:26</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">æŸ¥çœ‹ç»“æœ</span></span><br><span class="line"><span class="function"><span class="params">scala</span>&gt; <span class="params">score</span>.<span class="params">foreach</span>(<span class="params">println</span>)</span></span><br><span class="line"><span class="function">(<span class="params">daejong,(<span class="params">3,285.0</span>)</span>)</span></span><br><span class="line"><span class="function">(<span class="params">dottie,(<span class="params">3,257.0</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">åˆ†æ:</span></span><br><span class="line"><span class="function"><span class="params">rdd</span>.<span class="params">combineByKey</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  #åˆ†åŒºä¸­æ²¡æœ‰keyæ—¶çš„å¤„ç†å‡½æ•°, è¿”å›ä¸€ä¸ªkeyvalueå¯¹(<span class="params">1, value</span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  score=&gt;(<span class="params">1, score</span>),  </span></span></span><br><span class="line"><span class="function"><span class="params">  #åˆ†åŒºå­˜åœ¨keyæ˜¯çš„å¤„ç†å‡½æ•°, å°†åˆ†åŒºä¸­çš„keyvalueçš„key+1, value+newScore, ä½œä¸ºæ–°çš„keyvalueå¯¹è¿”å›åˆ°åˆ†åŒº</span></span></span><br><span class="line"><span class="function"><span class="params">  (<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    (<span class="params">c1:(<span class="params">Int, Double</span>), newScore</span>) =&gt; (<span class="params">c1._1+1, c1._2+newScore</span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">  </span>),</span></span></span><br><span class="line"><span class="function"><span class="params">  #æœ€åçš„æ”¶å°¾å·¥ä½œ, å°†å„ä¸ªåˆ†åŒºä¸­çš„ç»“æœ, è¿›è¡Œç´¯åŠ æ±‚å’Œæ“ä½œ.</span></span></span><br><span class="line"><span class="function"><span class="params">  (<span class="params"></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    (<span class="params">c1:(<span class="params">Int, Double</span>), c2:(<span class="params">Int, Double</span>)</span>) =&gt; (<span class="params">c1._1+c2._1, c1._2+c2._2</span>)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">  </span>)</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">æœ€åä¸€æ­¥æ±‚å¹³å‡å€¼</span></span><br><span class="line"><span class="function"><span class="params">scala</span>&gt; <span class="params">val</span> <span class="params">score2</span> = <span class="params">score</span>.<span class="params">map</span>(<span class="params">(<span class="params">name, (<span class="params">num, score</span>)</span>) =&gt; (<span class="params">name, score/num</span>)</span>)</span></span><br><span class="line"><span class="function">&lt;<span class="params">console</span>&gt;:1: <span class="params">error</span>: <span class="params">not</span> <span class="params">a</span> <span class="params">legal</span> <span class="params">formal</span> <span class="params">parameter</span>.</span></span><br><span class="line"><span class="function"><span class="params">Note</span>: <span class="params">Tuples</span> <span class="params">cannot</span> <span class="params">be</span> <span class="params">directly</span> <span class="params">destructured</span> <span class="params">in</span> <span class="params">method</span> <span class="params">or</span> <span class="params">function</span> <span class="params">parameters</span>.</span></span><br><span class="line"><span class="function">      <span class="params">Either</span> <span class="params">create</span> <span class="params">a</span> <span class="params">single</span> <span class="params">parameter</span> <span class="params">accepting</span> <span class="params">the</span> <span class="params">Tuple2</span>,</span></span><br><span class="line"><span class="function">      <span class="params">or</span> <span class="params">consider</span> <span class="params">a</span> <span class="params">pattern</span> <span class="params">matching</span> <span class="params">anonymous</span> <span class="params">function</span>: `&#123; <span class="params">case</span> (<span class="params">num, score</span>) =&gt;</span> ... &#125;</span><br><span class="line">val score2 = score.map(<span class="function">(<span class="params">name, (<span class="params">num, score</span>)</span>) =&gt;</span> (name, score/num))</span><br><span class="line">è¿™é‡Œæç¤ºæˆ‘ä»¬è¦ç”¨<span class="keyword">case</span>è¿›è¡Œåˆ¤æ–­å‚æ•°å’Œæ¥æ”¶</span><br><span class="line"></span><br><span class="line">scala&gt; val score2 = score.map&#123;<span class="keyword">case</span> <span class="function">(<span class="params">name, (<span class="params">num, score</span>)</span>) =&gt;</span> (name, score/num)&#125;</span><br><span class="line">score2: org.apache.spark.rdd.RDD[(<span class="built_in">String</span>, Double)] = MapPartitionsRDD[<span class="number">56</span>] at map at &lt;<span class="built_in">console</span>&gt;:<span class="number">30</span></span><br><span class="line"></span><br><span class="line">scala&gt; score2.foreach(println)</span><br><span class="line">(daejong,<span class="number">95.0</span>)</span><br><span class="line">(dottie,<span class="number">85.66666666666667</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å½“ç„¶å¯ä»¥å¯¹ç»“æœæ ¼å¼åŒ–ä¸‹</span><br><span class="line">scala&gt; <span class="string">"%.2f"</span>.format(<span class="number">1.14534</span>)</span><br><span class="line">res87: <span class="built_in">String</span> = <span class="number">1.15</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="number">1.1231</span>.toInt</span><br><span class="line">res88: Int = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">å››èˆäº”å…¥ä¿ç•™ä¸¤ä½å°æ•°:</span><br><span class="line">scala&gt; val score3 = score2.map&#123;<span class="keyword">case</span><span class="function">(<span class="params">name, score</span>)=&gt;</span>(name, <span class="string">"%.2f"</span>.format(score))&#125;</span><br><span class="line">score3: org.apache.spark.rdd.RDD[(<span class="built_in">String</span>, <span class="built_in">String</span>)] = MapPartitionsRDD[<span class="number">59</span>] at map at &lt;<span class="built_in">console</span>&gt;:<span class="number">32</span></span><br><span class="line"></span><br><span class="line">scala&gt; score3.foreach(println)</span><br><span class="line">(dottie,<span class="number">85.67</span>)</span><br><span class="line">(daejong,<span class="number">95.00</span>)</span><br></pre></td></tr></table></figure>
<h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾:"></a>ç»“å°¾:</h2><p>Sparkæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„è®¡ç®—, å› æ­¤è®¡ç®—é€Ÿåº¦å¾ˆå¿«.</p>
<p>Sparkçš„åŸºç¡€çŸ¥è¯†ç‚¹å·®ä¸å¤šéƒ½æ¶µç›–äº†.</p>
<p>åé¢å°±è¦æ·±å…¥å­¦ä¹ Spark. å¦‚Sparkçš„æ¶æ„å’Œè¿è¡ŒåŸç†ä»¥åŠéƒ¨ç½²ç¨‹åºç­‰ç­‰.</p>
<p>ä¸€èµ·åŠ æ²¹å§! </p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/hadoop/" rel="tag"># hadoop</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/22/ä¸€èµ·å­¦Spark/" rel="next" title="ä¸€èµ·å­¦Spark">
                <i class="fa fa-chevron-left"></i> ä¸€èµ·å­¦Spark
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/25/å¦‚ä½•çœ‹å¾…SparkæŠ€æœ¯-æ‘˜æŠ„/" rel="prev" title="å¦‚ä½•çœ‹å¾…SparkæŠ€æœ¯-æ‘˜æŠ„">
                å¦‚ä½•çœ‹å¾…SparkæŠ€æœ¯-æ‘˜æŠ„ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Daejong">
          <p class="site-author-name" itemprop="name">Daejong</p>
           
              <p class="site-description motion-element" itemprop="description">äººç”Ÿè‹¦çŸ­...</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">72</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              å¥½å‹é“¾æ¥
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://example.com/" title="å¥½å‹" target="_blank">å¥½å‹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://betterlxc.com" title="åˆ˜ç‚ç‚çš„åšå®¢" target="_blank">åˆ˜ç‚ç‚çš„åšå®¢</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å…ˆçƒ­ä¸‹èº«ğŸ˜œ-Hadoop"><span class="nav-number">1.</span> <span class="nav-text">å…ˆçƒ­ä¸‹èº«ğŸ˜œ Hadoop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ScalaåŸºç¡€"><span class="nav-number">2.</span> <span class="nav-text">ScalaåŸºç¡€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD-å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†"><span class="nav-number">3.</span> <span class="nav-text">Sparkæ ¸å¿ƒæ¦‚å¿µâ€“RDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDDçš„åŸºæœ¬æ“ä½œ"><span class="nav-number">4.</span> <span class="nav-text">RDDçš„åŸºæœ¬æ“ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDDsä¸­çš„é›†åˆè¿ç®—"><span class="nav-number">5.</span> <span class="nav-text">RDDsä¸­çš„é›†åˆè¿ç®—</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDDçš„Actionæ“ä½œ"><span class="nav-number">6.</span> <span class="nav-text">RDDçš„Actionæ“ä½œ.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDDsçš„ç‰¹æ€§"><span class="nav-number">7.</span> <span class="nav-text">RDDsçš„ç‰¹æ€§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDDsçš„KeyValueå¯¹"><span class="nav-number">8.</span> <span class="nav-text">RDDsçš„KeyValueå¯¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»“å°¾"><span class="nav-number">9.</span> <span class="nav-text">ç»“å°¾:</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>
	
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <footer id="footer" class="footer">
     	 <div class="footer-inner">
		<div class="powered-by">
		<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
 		 æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span>
			    </span>
	</div>
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daejong</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
